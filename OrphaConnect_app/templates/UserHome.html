<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="UserHome.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
  <div class="header">
      <p class="title">OrphaConnect</p>
      <nav class="menu">
          <a href="home.html">Home</a>
          <a href="#">About</a>
          <a href="#">Profile</a>
          <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@user">Feedback</a>
          <a href="login.html">Logout</a>
      </nav>
      <div class="menu-toggle" onclick="toggleMenu()">â˜°</div>
  </div>

  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">New message</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="recipient-name" class="col-form-label">Email:</label>
              <input type="text" class="form-control" id="recipient-name">
            </div>
            <div class="mb-3">
              <label for="message-text" class="col-form-label">Feedback:</label>
              <textarea class="form-control" id="message-text"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Send message</button>
        </div>
      </div>
    </div>
  </div>

  <main>
    <div class="profile-container">
      <div class="profile-header">
        <div class="profile-avatar">
          <svg id="svgAvatar" xmlns="http://www.w3.org/2000/svg" height="90" width="90" viewBox="0 -960 960 960" style="display:none;">
            <path d="M240.924-268.307q51-37.846 111.115-59.769Q412.154-349.999 480-349.999t127.961 21.923q60.115 21.923 111.115 59.769 37.308-41 59.116-94.923Q800-417.154 800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 62.846 21.808 116.77 21.808 53.923 59.116 94.923ZM480-450.001q-54.769 0-92.384-37.615T350.001-580q0-54.769 37.615-92.384T480-709.999q54.769 0 92.384 37.615T609.999-580q0 54.769-37.615 92.384T480-450.001Zm0 350q-79.154 0-148.499-29.77-69.346-29.769-120.654-81.076-51.307-51.308-81.076-120.654-29.77-69.345-29.77-148.499t29.77-148.499q29.769-69.346 81.076-120.654 51.308-51.307 120.654-81.076 69.345-29.77 148.499-29.77t148.499 29.77q69.346 29.769 120.654 81.076 51.307 51.308 81.076 120.654 29.77 69.345 29.77 148.499t-29.77 148.499q-29.769 69.346-81.076 120.654-51.308 51.307-120.654 81.076-69.345 29.77-148.499 29.77Z"/>
          </svg>
        </div>
        <div class="profile-info">
          <h1>Jenson Yuvaraj</h1>
          <p>Level 1 <span class="badge text-bg-info">Donor</span></p>
        </div>
      </div>
      <div class="profile-progress">
        <div class="progress">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <p>Next Level: Donate 5 more to Level 4</p>
      </div>
      <div class="profile-stats">
        <div class="stat">
          <h2>Total Donations</h2>
          <p>3</p>
        </div>
        <div class="stat">
          <h2>Current Level</h2>
          <p>Level 1</p>
        </div>
        <div class="stat">
          <h2>Lifetime Impact</h2>
          <p>Helped 5 people</p>
        </div>
      </div>
    </div>

    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link active" aria-current="page" onclick="openContain('Charity')">Charity</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="openContain('Posts')">Posts</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="openContain('Updates')"">Updates</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="openContain('Rewards')">Rewards</a>
      </li>
    </ul>

    <div class="char_con">
      <div class="charity-container">
        <div class="charity-wrapper">
          <div class="charity-content" onclick="openModal('modal1')">
            <h2>Food Charity</h2>
            <p>Donate to help provide food to those in need.</p>
          </div>
          <div class="charity-content" onclick="openModal('Fund Charity')">
            <h2>Fund Charity</h2>
            <p>Donate to support various charitable causes.</p>
          </div>
          <div class="charity-content" onclick="openModal('modal2')">
            <h2>Other Charity</h2>
            <p>Donate to support other causes.</p>
          </div>
        </div>
      </div>

      <div class="post-container" style="display: none;"></div>
    
      <div class="container" style="display: none; color: gray;">
        <div class="row">
          <div class="coltext-center">
            <h4>No updates available...</h4>
          </div>
        </div>
      </div>
    </div>
    
        
    <div class="modal" id="modal1">
      <div class="modal-content">
        <span onclick="closeModal('modal1')" style="cursor: pointer; float: right;">&times;</span>
        <h2 class="modal-title">Register for Food Donation</h2>
        <form class="myForm" action="http://localhost:3000/submitForm" method="POST">
          <label for="food-type">Food type:</label><br>
          <select class="mySelect" name="food-type" required>
            <option value="" disabled selected hidden>Please select an option</option>
            <option value="Vegetarian">Vegetarian</option>
            <option value="Non-vegetarian">Non-vegetarian</option>
          </select><br><br>


          <div class="input-group mb-3">
            <label class="input-group-text" for="food-image">Upload Food Image</label>
            <input type="file" class="form-control food-image" id="food-image" accept="image/*;capture=camera">
          </div>

          <label for="location">Location:</label><br>
          <input type="text" class="location" name="location" placeholder="Enter your location" required><br><br>
          

          <label for="contact-number">Contact Number:</label><br>
          <input type="tel" class="contact-number" name="contact-number" placeholder="Enter your contact number" required><br><br>

          <label for="food-type">Delivery type:</label><br>
          <select class="delivery-type" name="delivery-type" required>
            <option value="" disabled selected hidden>Please select an option</option>
            <option value="Doorstep">Doorstep</option>
            <option value="Self-retrieval">Self-retrieval</option>
          </select><br>
          <input type="submit" value="Submit">
        </form>
      </div>
    </div>

    <div class="modal" id="editModal1">
      <div class="modal-content">
        <span onclick="closeModal('editModal1')" style="cursor: pointer; float: right;">&times;</span>
        <h2 class="modal-title">Register for Food Donation</h2>
        <form class="myForm" id="editForm1" action="http://localhost:3000/submitForm" method="POST">
          <label for="food-type">Food type:</label><br>
          <select class="mySelect" name="food-type" required>
            <option value="" disabled selected hidden>Please select an option</option>
            <option value="Vegetarian">Vegetarian</option>
            <option value="Non-vegetarian">Non-vegetarian</option>
          </select><br><br>

          <div class="input-group mb-3">
            <label class="input-group-text" for="food-image">Upload Food Image</label>
            <input type="file" class="form-control food-image" id="food-image" accept="image/*;capture=camera">
          </div>

          <label for="location">Location:</label><br>
          <input type="text" class="location" name="location" placeholder="Enter your location" required><br><br>
          

          <label for="contact-number">Contact Number:</label><br>
          <input type="tel" class="contact-number" name="contact-number" placeholder="Enter your contact number" required><br><br>

          <div class="charity-type"></div>
          <div class="id-num"></div>

          <label for="food-type">Delivery type:</label><br>
          <select class="delivery-type" name="delivery-type" required>
            <option value="" disabled selected hidden>Please select an option</option>
            <option value="Doorstep">Doorstep</option>
            <option value="Self-retrieval">Self-retrieval</option>
          </select><br>
          <button class="updatePost" id="editButton">Edit</button>
          <button class="updatePost" id="delButton">Delete</button>
        </form>
      </div>
    </div>

    <div class="modal" id="modal2">
      <div class="modal-content">
        <span onclick="closeModal('modal2')" style="cursor: pointer; float: right;">&times;</span>
        <h2 class="modal-title">Register for Other Donation</h2>
        <form class="myForm" action="http://localhost:3000/submitForm" method="POST">
          <label for="product">Product:</label><br>
          <input type="text" class="product" name="product" placeholder="Enter the product name" required><br><br>
          <textarea class="prod-describe" name="product" placeholder="Product description"></textarea><br><br>

          <div class="input-group mb-3">
            <label class="input-group-text" for="food-image">Upload Product Image</label>
            <input type="file" class="form-control food-image" id="food-image" accept="image/*;capture=camera">
          </div>

          <label for="location">Location:</label><br>
          <input type="text" class="location" name="location" placeholder="Enter your location" required><br><br>
          

          <label for="contact-number">Contact Number:</label><br>
          <input type="tel" class="contact-number" name="contact-number" placeholder="Enter your contact number" required><br><br>

          <label for="food-type">Delivery type:</label><br>
          <select class="delivery-type" name="delivery-type" required>
            <option value="" disabled selected hidden>Please select an option</option>
            <option value="Doorstep">Doorstep</option>
            <option value="Self-retrieval">Self-retrieval</option>
          </select><br>
          <input type="submit" value="Submit">
        </form>
      </div>
    </div>

    <div class="modal" id="editModal2">
      <div class="modal-content">
        <span onclick="closeModal('editModal2')" style="cursor: pointer; float: right;">&times;</span>
        <h2 class="modal-title">Register for Other Donation</h2>
        <form class="myForm" id="editForm2" action="http://localhost:3000/submitForm" method="POST">
          <label for="product">Product:</label><br>
          <input type="text" class="product" name="product" placeholder="Enter the product name" required><br><br>
          <textarea class="prod-describe" name="product" placeholder="Product description"></textarea><br><br>

          <div class="input-group mb-3">
            <label class="input-group-text" for="food-image">Upload Product Image</label>
            <input type="file" class="form-control food-image" id="food-image" accept="image/*;capture=camera">
          </div>

          <label for="location">Location:</label><br>
          <input type="text" class="location" name="location" placeholder="Enter your location" required><br><br>
          

          <label for="contact-number">Contact Number:</label><br>
          <input type="tel" class="contact-number" name="contact-number" placeholder="Enter your contact number" required><br><br>

          <div class="charity-type"></div>
          <div class="id-num"></div>

          <label for="food-type">Delivery type:</label><br>
          <select class="delivery-type" name="delivery-type" required>
            <option value="" disabled selected hidden>Please select an option</option>
            <option value="Doorstep">Doorstep</option>
            <option value="Self-retrieval">Self-retrieval</option>
          </select><br>
          <button class="updatePost" id="editButton">Edit</button>
          <button class="updatePost" id="delButton">Delete</button>
        </form>
      </div>
    </div>


    
  </main>    
  <footer>
      <div class="footer-content">
          <p>&copy; 2024 OrphaConnect Website. All rights reserved.</p>
          <p>Contact: padhavangroups@gmail.com</p>
      </div>
  </footer>
    
  <script>
      function toggleMenu() {
          var menu = document.querySelector(".menu");
          menu.classList.toggle("show");
      }

      const exampleModal = document.getElementById('exampleModal');
      if (exampleModal) {
        exampleModal.addEventListener('show.bs.modal', event => {
          const button = event.relatedTarget;
          const recipient = button.getAttribute('data-bs-whatever');
          const modalTitle = exampleModal.querySelector('.modal-title');
          const modalBodyInput = exampleModal.querySelector('.modal-body input');
          modalTitle.textContent = `New message to ${recipient}`;
          modalBodyInput.value = recipient;
        });
      }
  
      function openModal(charityModal) {
        document.getElementById(charityModal).style.display = 'flex';
      }

      function closeModal(charityModal) {
        document.getElementById(charityModal).style.display = 'none';
      }
      
      function progressVal(completedDonations, totalDonations) {
          var progressBar = document.getElementById('progressBar');
          
          var percentage = (completedDonations / totalDonations) * 100;
          
          progressBar.style.width = percentage + '%';
          progressBar.innerText = percentage.toFixed(0) + '%';
      }

      progressVal(12, 22);

      document.addEventListener("DOMContentLoaded", function() {
        var navTabs = document.querySelector(".nav.nav-tabs");

        navTabs.addEventListener("click", function(event) {
          var targetNavItem = event.target.closest(".nav-item");
          if (!targetNavItem) return; 
          var navItems = navTabs.querySelectorAll(".nav-item");

          navItems.forEach(function(navItem) {
            navItem.querySelector(".nav-link").classList.remove("active");
            navItem.querySelector(".nav-link").removeAttribute("aria-current");
          });

          targetNavItem.querySelector(".nav-link").classList.add("active");
          targetNavItem.querySelector(".nav-link").setAttribute("aria-current", "page");
        });
      });

      function openContain(navOption) {
        var ch_container = document.querySelector(".charity-container");
        var postcontainer = document.querySelector(".post-container");
        var container = document.querySelector('.container');

        if (navOption === "Charity") {
          ch_container.style.display = "flex";
          postcontainer.style.display = "none";
          container.style.display = "none";
        }else if (navOption === "Posts"){
          ch_container.style.display = "none";
          postcontainer.style.display = "flex";
          container.style.display = "none";
          fetchDataAndCreateContainers();
          
        }else {
          ch_container.style.display = "none";
          postcontainer.style.display = "none";
          container.style.display = "flex";
          document.querySelector('.coltext-center h4').innerHTML = 'No '+navOption+' available at the moment...';
        }
      }
      
      document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll('.myForm').forEach(function(form) {
          form.addEventListener('submit', function(event) {
            event.preventDefault(); 

            var location = form.querySelector('.location').value;
            var contact = form.querySelector('.contact-number').value;
            var deliveryType = form.querySelector('.delivery-type').value;

            if (form.closest('.modal').id === 'modal1') {

              var formData = {
                  charityType: "Food",
                  foodType: form.querySelector('.mySelect').value,
                  location: location,
                  delivery: deliveryType,
                  contact: contact
              };

              console.log(formData);

              sendData(formData);
            } else if (form.closest('.modal').id === 'modal2') {
              var formData ={
                charityType: "Other",
                productItem: form.querySelector('.product').value,
                productDesc: form.querySelector('.prod-describe').value,
                location: location,
                delivery: deliveryType,
                contact: contact
              }

              sendData(formData);
            }
        
          });
        }); 
      });

      document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll(".updatePost").forEach(function(button) {
        button.addEventListener('click', function(event) {
            event.preventDefault(); 
            var form = button.closest('form'); // Get the closest form element
            var location = form.querySelector('.location').value;
            var contact = form.querySelector('.contact-number').value;
            var deliveryType = form.querySelector('.delivery-type').value;
            var charityType = form.querySelector('.charity-type').getAttribute("data-hidden-info");
            var id = form.querySelector('.id-num').getAttribute("data-hidden-info");

            var modal = form.closest('.modal');
            var editButton = form.querySelector('#editButton');
            var delButton = form.querySelector('#delButton');

            if (charityType.toLowerCase() === "food") {
              var formData = {
                  charityType: charityType,
                  foodType: form.querySelector('.mySelect').value,
                  location: location,
                  contact: contact,
                  delivery: deliveryType,
                  id: id
              };
            } else {
              var formData = {
                  charityType: charityType,
                  productItem: form.querySelector('.product').value,
                  productDesc: form.querySelector('.prod-describe').value,
                  location: location,
                  contact: contact,
                  delivery: deliveryType,
                  id: id
              };
            }
            if (button === editButton) {
              console.log("Pressed edit button from "+editButton.id);
              sendData(formData, "edit");
            } else if (button === delButton) {
              console.log("Pressed delete button form "+delButton.id);
              sendData(formData, "delete");
            }
        });
    });
});


function sendData(formData, operation = "append") {
    var dataToSend = {
        formData: formData,
        operation: operation
    };

    fetch('http://localhost:3000/submitForm', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(dataToSend) // Send the combined data
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log('Form data saved:', data);
        })
        .catch(error => {
            console.error('Error saving form data:', error);
        });
}


  </script>
  <script src="postContainers.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>